#!/usr/bin/env bash

#
# This file is part of the fabschurt/scripts package.
#
# (c) 2015 Fabien Schurter <dev@fabschurt.net>
#
# For the full copyright and license information, please view the LICENSE
# file that was distributed with this source code.
#
# @author    Fabien Schurter <dev@fabschurt.net>
# @license   MIT
# @copyright 2015 Fabien Schurter
#

# Check argument count
if [[ $# > 0 ]]; then
  echo 'This script accepts no argument.'
  exit 1
fi

# Check that dependencies are installed
exec_dependencies=( 'backup' )
for exec in ${exec_dependencies[@]}; do
  type $exec > /dev/null 2>&1
  if [[ $? > 0 ]]; then
    echo "Error: the '${exec}' program is required."
    exit 1
  fi
done

# Run
if [[ ! $(ssh-add -L) =~ $HOME/\.ssh/id_rsa ]]; then
  ssh-add -k -t 1800 $HOME/.ssh/id_rsa
fi
if [[ ! $? > 0 ]]; then
  backup perform --triggers system,documents
fi
