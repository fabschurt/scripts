#!/usr/bin/env bash

#
# This file is part of the fabschurt/scripts package.
#
# (c) 2015 Fabien Schurter <dev@fabschurt.net>
#
# For the full copyright and license information, please view the LICENSE
# file that was distributed with this source code.
#
# @author    Fabien Schurter <dev@fabschurt.net>
# @license   MIT
# @copyright 2015 Fabien Schurter
#

# Check that current user is root
if [[ $EUID != 0 ]]; then
  echo 'Error: this script must be run as root.'
  exit 1
fi

# Check argument count
if [[ $# > 0 ]]; then
  echo 'This script accepts no argument.'
  exit 1
fi

# Check that dependencies are installed
exec_dependencies=( 'mdutil' 'launchctl' )
for exec in ${exec_dependencies[@]}; do
  type $exec > /dev/null 2>&1
  if [[ $? > 0 ]]; then
    echo "Error: the '${exec}' program is required (this script works on Mac OS X only)."
    exit 1
  fi
done

# Run
mdutil -a -i off
launchctl unload -w /System/Library/LaunchDaemons/com.apple.metadata.mds.plist
chmod 0600 /System/Library/CoreServices/Search.bundle/Contents/MacOS/Search
killall SystemUIServer
